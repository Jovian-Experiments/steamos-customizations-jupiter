#!/bin/sh
# -*- mode: sh; indent-tabs-mode: nil; sh-basic-offset: 4; -*-
# vim: et sts=4 sw=4

#  SPDX-License-Identifier: LGPL-2.1+
#
#  Copyright © 2019 Collabora Ltd.
#  Copyright © 2019 Valve Corporation.
#
#  This file is part of steamos-customizations.
#
#  steamos-customizations is free software; you can redistribute it and/or modify
#  it under the terms of the GNU Lesser General Public License as published
#  by the Free Software Foundation; either version 2.1 of the License, or
#  (at your option) any later version.

# Some tweaks for the steamos update mode

. /lib/dracut-lib.sh

SYSTEMD_UNIT=$(getarg 'systemd.unit=')
[ "$SYSTEMD_UNIT" = "steamos-update-os.target" ] || return

info "Redirecting update services output to console"

mkdir -p /run/systemd/system/rauc.service.d
echo -e '[Service]\nStandardOutput=journal+console' \
    > /run/systemd/system/rauc.service.d/standard-output.conf

mkdir -p /run/systemd/system/steamos-update-os.service.d
echo -e '[Service]\nStandardOutput=journal+console' \
    > /run/systemd/system/steamos-update-os.service.d/standard-output.conf
