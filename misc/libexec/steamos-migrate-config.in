#!/bin/bash
# -*- mode: sh; indent-tabs-mode: nil; sh-basic-offset: 4; -*-
# vim: et sts=4 sw=4

#  SPDX-License-Identifier: MPL-2.0
#
#  Copyright Â 2022 Valve Corporation.
#
#  This file is part of steamos-customizations.
#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

set -e
set -u

# perform idempotent configuration update steps that may be required after
# a system upgrade or factory reset.

# Wireless network connections created by wpa_supplicant may have
# some properties that iwd does not support. Fix them up now.
function update_network_connections()
{
    for f in $( grep -l '^type=wifi' /etc/NetworkManager/system-connections/*.nmconnection )
    do
        sed -i 's/^\(mac-address\|interface-name\|permissions\|bssid\)=.*//' $f ||:
    done
}

update_network_connections

